<div class="container-fluid py-4">
  <!-- Header -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-body">
          <h1 class="card-title mb-3">SignalR Hub Tester</h1>
          <div class="d-flex align-items-center">
            <span class="me-2">Status:</span>
            <span class="badge" [ngClass]="(isLoggedIn$ | async) ? 'bg-success' : 'bg-secondary'">
              {{ (isLoggedIn$ | async) ? 'Authenticated' : 'Not Authenticated' }}
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Grid Layout -->
  <div class="row g-4">
    
    <!-- Authentication Card -->
    <div class="col-lg-6">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-primary text-white">
          <h2 class="h5 mb-0">Authentication</h2>
        </div>
        <div class="card-body">
          
          <!-- Login Form -->
          <div *ngIf="!(isLoggedIn$ | async)">
            <div class="mb-3">
              <label for="email" class="form-label">Email Address</label>
              <input 
                type="email" 
                id="email"
                class="form-control"
                [(ngModel)]="loginRequest.email"
                [disabled]="(isLoggingIn$ | async) ?? false"
                placeholder="Enter email">
            </div>
            
            <div class="mb-3">
              <label for="password" class="form-label">Password</label>
              <input 
                type="password" 
                id="password"
                class="form-control"
                [(ngModel)]="loginRequest.password"
                [disabled]="(isLoggingIn$ | async) ?? false"
                placeholder="Enter password">
            </div>
            
            <button 
              class="btn btn-primary w-100"
              (click)="onLogin()"
              [disabled]="(isLoggingIn$ | async) ?? false">
              <span *ngIf="!(isLoggingIn$ | async)">Login</span>
              <span *ngIf="isLoggingIn$ | async">
                <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                Logging in...
              </span>
            </button>
            
            <div *ngIf="loginError$ | async as error" class="alert alert-danger mt-3 mb-0">
              <strong>Error:</strong> {{ error }}
            </div>
          </div>
          
          <!-- Logged In State -->
          <div *ngIf="isLoggedIn$ | async">
            <div class="alert alert-success">
              <strong>âœ“ Authenticated Successfully</strong>
            </div>
            <div class="mb-3">
              <label class="form-label">Access Token</label>
              <input type="text" class="form-control" [value]="getMaskedToken()" readonly>
            </div>
            <button class="btn btn-danger w-100" (click)="onLogout()">Logout</button>
          </div>
          
        </div>
      </div>
    </div>

    <!-- SignalR Connection Card -->
    <div class="col-lg-6">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-success text-white">
          <h2 class="h5 mb-0">SignalR Connection</h2>
        </div>
        <div class="card-body">
          
          <div class="mb-3">
            <label class="form-label">Hub Endpoint</label>
            <input type="text" class="form-control" value="https://localhost:7179/hubs/notification" readonly>
          </div>
          
          <div class="mb-3">
            <label class="form-label">Connection Status</label>
            <div>
              <span class="badge fs-6" 
                [ngClass]="{
                  'bg-success': (connectionStatus$ | async) === 'Connected',
                  'bg-warning text-dark': (connectionStatus$ | async) === 'Connecting...',
                  'bg-danger': (connectionStatus$ | async) === 'Disconnected'
                }">
                {{ connectionStatus$ | async }}
              </span>
            </div>
          </div>
          
          <div class="d-grid gap-2">
            <button 
              class="btn btn-success"
              (click)="onConnectSignalR()"
              [disabled]="!(isLoggedIn$ | async) || (connectionStatus$ | async) === 'Connected' || (connectionStatus$ | async) === 'Connecting...'">
              Connect to Hub
            </button>
            
            <button 
              class="btn btn-outline-danger"
              (click)="onDisconnectSignalR()"
              [disabled]="(connectionStatus$ | async) === 'Disconnected'">
              Disconnect
            </button>
          </div>
          
          <div *ngIf="!(isLoggedIn$ | async)" class="alert alert-warning mt-3 mb-0">
            Please login first to connect to SignalR hub
          </div>
          
        </div>
      </div>
    </div>

    <!-- Hub Messages Card -->
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
          <h2 class="h5 mb-0">Hub Messages</h2>
          <span class="badge bg-light text-dark">{{ (messages$ | async)?.length || 0 }}</span>
        </div>
        <div class="card-body">
          
          <div class="mb-3">
            <button 
              class="btn btn-outline-danger btn-sm"
              (click)="onClearMessages()"
              [disabled]="(messages$ | async)?.length === 0">
              Clear Messages
            </button>
          </div>
          
          <div class="border rounded p-3 bg-light" style="max-height: 400px; overflow-y: auto;">
            
            <div *ngIf="(messages$ | async)?.length === 0" class="text-center text-muted">
              <p class="mb-1">No messages received yet</p>
              <small>Messages from the SignalR hub will appear here</small>
            </div>
            
            <div *ngIf="(messages$ | async)?.length ?? 0 > 0" class="list-group">
              <div *ngFor="let message of (messages$ | async); let i = index" 
                class="list-group-item list-group-item-action mb-2">
                <div class="d-flex w-100 justify-content-between">
                  <h6 class="mb-1">Message #{{ i + 1 }}</h6>
                </div>
                <p class="mb-0">{{ message }}</p>
              </div>
            </div>
            
          </div>
          
        </div>
      </div>
    </div>

    <!-- Debug Information Card -->
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header bg-secondary text-white">
          <h2 class="h5 mb-0">Debug Information</h2>
        </div>
        <div class="card-body">
          <ul class="list-group list-group-flush">
            <li class="list-group-item">Open browser console (F12) for detailed logs</li>
            <li class="list-group-item">SignalR uses automatic reconnection</li>
            <li class="list-group-item">Authorization: Bearer token from login</li>
            <li class="list-group-item">Methods: ReceiveMessage, ReceiveNotification</li>
          </ul>
        </div>
      </div>
    </div>
    
  </div>
</div>
